# План разработки Telegram-бота для салона красоты

## Обзор проекта

Система состоит из 4 основных компонентов:
1. **Telegram-бот** - приветствие и запуск web-приложения
2. **Backend API** (Node.js + SQLite) - основная бизнес-логика
3. **Client Web App** (Next.js) - интерфейс для клиентов
4. **Admin Panel** (Next.js) - панель управления для администраторов

---

## Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Telegram Bot   │────│   Backend API   │────│   SQLite DB     │
│   (Python)      │    │   (Node.js)     │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              │
                    ┌─────────┴─────────┐
                    │                   │
           ┌─────────────────┐  ┌─────────────────┐
           │ Client Web App  │  │  Admin Panel    │
           │   (Next.js)     │  │   (Next.js)     │
           └─────────────────┘  └─────────────────┘
```

---

## Этап 1: Настройка проекта и структуры

### 1.1 Создание структуры проекта
```
salon-bot/
├── backend/
│   ├── src/
│   │   ├── app.ts
│   │   ├── server.ts
│   │   ├── models/
│   │   ├── routes/
│   │   ├── middleware/
│   │   ├── utils/
│   │   └── types/
│   ├── prisma/
│   │   ├── schema.prisma
│   │   └── migrations/
│   ├── package.json
│   ├── tsconfig.json
│   └── .env
├── telegram-bot/
│   ├── src/
│   │   ├── bot.ts
│   │   ├── handlers/
│   │   └── utils/
│   ├── package.json
│   ├── tsconfig.json
│   └── .env
├── frontend/
│   ├── client-app/
│   │   ├── package.json
│   │   ├── next.config.js
│   │   ├── pages/
│   │   ├── components/
│   │   └── styles/
│   └── admin-panel/
│       ├── package.json
│       ├── next.config.js
│       ├── pages/
│       ├── components/
│       └── styles/
└── README.md
```

### 1.2 Технологический стек
- **Backend**: Node.js, Express.js, TypeScript
- **База данных**: SQLite с Prisma ORM
- **Telegram Bot**: Node.js с node-telegram-bot-api
- **Frontend**: Next.js, React, TypeScript, Tailwind CSS
- **Deployment**: Docker, nginx (опционально)

---

## Этап 2: Backend разработка (Node.js + SQLite)

### 2.1 Модели данных

#### Пользователи
```typescript
interface User {
  id: number;
  telegramId: number;
  firstName: string;
  lastName: string;
  phone: string;
  createdAt: Date;
}
```

#### Мастера
```typescript
interface Master {
  id: number;
  name: string;
  specialization: string;
  description: string;
  photoUrl: string;
  isActive: boolean;
  createdAt: Date;
}
```

#### Услуги
```typescript
interface Service {
  id: number;
  name: string;
  description: string;
  price: number;
  duration: number; // в минутах
  isActive: boolean;
  createdAt: Date;
}
```

#### Записи
```typescript
interface Appointment {
  id: number;
  userId: number;
  masterId: number;
  serviceId: number;
  appointmentDate: Date;
  status: 'pending' | 'confirmed' | 'completed' | 'cancelled';
  notes: string;
  createdAt: Date;
}
```

#### Расписание мастеров
```typescript
interface MasterSchedule {
  id: number;
  masterId: number;
  dayOfWeek: number; // 0-6
  startTime: string; // HH:mm
  endTime: string;   // HH:mm
  isWorking: boolean;
}
```

#### Администраторы
```typescript
interface Admin {
  id: number;
  username: string;
  passwordHash: string;
  email: string;
  isActive: boolean;
  createdAt: Date;
}
```

### 2.2 API Endpoints

#### Пользователи
- `POST /api/users/` - создание пользователя
- `GET /api/users/{telegram_id}` - получение пользователя по Telegram ID
- `PUT /api/users/{user_id}` - обновление данных пользователя

#### Услуги
- `GET /api/services/` - список активных услуг
- `GET /api/services/{service_id}` - детали услуги
- `POST /api/services/` - создание услуги (админ)
- `PUT /api/services/{service_id}` - обновление услуги (админ)
- `DELETE /api/services/{service_id}` - деактивация услуги (админ)

#### Мастера
- `GET /api/masters/` - список активных мастеров
- `GET /api/masters/{master_id}` - детали мастера
- `GET /api/masters/{master_id}/schedule` - расписание мастера
- `GET /api/masters/{master_id}/available-slots` - свободные слоты
- `POST /api/masters/` - создание мастера (админ)
- `PUT /api/masters/{master_id}` - обновление мастера (админ)

#### Записи
- `POST /api/appointments/` - создание записи
- `GET /api/appointments/user/{user_id}` - записи пользователя
- `GET /api/appointments/` - все записи (админ)
- `PUT /api/appointments/{appointment_id}` - обновление записи
- `DELETE /api/appointments/{appointment_id}` - отмена записи

#### Аутентификация (для админ панели)
- `POST /api/auth/login` - авторизация админа
- `POST /api/auth/refresh` - обновление токена

---

## Этап 3: Telegram Bot

### 3.1 Функционал бота
- Приветственное сообщение при `/start`
- Кнопка "Открыть приложение" (Web App)
- Отправка уведомлений о записях
- Команды:
  - `/start` - запуск бота
  - `/help` - помощь

### 3.2 Структура кода бота
```typescript
// Основные handlers
const startHandler = async (msg: Message) => { ... }
const helpHandler = async (msg: Message) => { ... }
const webAppDataHandler = async (msg: Message) => { ... }

// Уведомления
const sendAppointmentReminder = async (telegramId: number, appointmentInfo: any) => { ... }
const sendAppointmentConfirmation = async (telegramId: number, appointmentInfo: any) => { ... }
```

### 3.3 Web App интеграция
- Настройка Web App URL
- Передача данных пользователя в web-приложение
- Обработка данных из web-приложения

---

## Этап 4: Client Web App (Next.js)

### 4.1 Страницы и компоненты

#### Основные страницы
- `/` - главная страница с услугами
- `/services` - список услуг
- `/masters` - список мастеров
- `/booking` - форма записи
- `/appointments` - мои записи
- `/profile` - профиль пользователя

#### Основные компоненты
- `ServiceCard` - карточка услуги
- `MasterCard` - карточка мастера
- `BookingForm` - форма записи
- `AppointmentCard` - карточка записи
- `Calendar` - календарь для выбора даты
- `TimeSlots` - слоты времени

### 4.2 Функционал
- Просмотр услуг и цен
- Выбор мастера
- Выбор даты и времени
- Создание записи
- Просмотр своих записей
- Отмена записи
- Редактирование профиля

### 4.3 Telegram Web App API
- Получение данных пользователя из Telegram
- Отправка данных обратно в бот
- Закрытие web-приложения

---

## Этап 5: Admin Panel (Next.js)

### 5.1 Страницы администратора

#### Аутентификация
- `/admin/login` - авторизация

#### Управление
- `/admin/dashboard` - главная панель
- `/admin/services` - управление услугами
- `/admin/masters` - управление мастерами
- `/admin/appointments` - управление записями
- `/admin/users` - пользователи
- `/admin/notifications` - отправка уведомлений

### 5.2 Функционал админ панели
- CRUD операции для услуг
- CRUD операции для мастеров
- Управление расписанием мастеров
- Просмотр и управление записями
- Отправка push-уведомлений через бот
- Статистика и отчеты

---

## Этап 6: Интеграция и тестирование

### 6.1 API интеграция
- Подключение frontend к backend API
- Настройка CORS
- Обработка ошибок

### 6.2 Telegram Bot интеграция
- Настройка webhook для бота
- Интеграция с backend для отправки уведомлений
- Тестирование Web App

### 6.3 Тестирование
- Unit тесты для backend
- Интеграционные тесты
- E2E тестирование пользовательских сценариев

---

## Этап 7: Деплой и настройка

### 7.1 Подготовка к деплою
- Dockerfile для backend
- Настройка переменных окружения
- Настройка базы данных

### 7.2 Деплой
- Настройка сервера
- Деплой backend API
- Деплой frontend приложений
- Настройка nginx (при необходимости)

### 7.3 Telegram Bot
- Регистрация бота в BotFather
- Настройка Web App URL
- Настройка webhook

---

## Порядок разработки (рекомендуемый)

### Неделя 1: Backend foundation
1. Настройка проекта и структуры
2. Создание моделей данных (Prisma)
3. Базовые CRUD операции
4. Основные API endpoints

### Неделя 2: Core API
1. Завершение API endpoints
2. Аутентификация для админ панели
3. Валидация данных
4. Тестирование API

### Неделя 3: Telegram Bot
1. Создание базового бота
2. Интеграция с Web App
3. Система уведомлений
4. Тестирование бота

### Неделя 4: Client Web App
1. Настройка Next.js проекта
2. Основные компоненты и страницы
3. Интеграция с API
4. Telegram Web App интеграция

### Неделя 5: Admin Panel
1. Создание админ панели
2. Аутентификация и авторизация
3. CRUD интерфейсы
4. Система уведомлений

### Неделя 6: Финализация
1. Интеграционное тестирование
2. UI/UX доработки
3. Подготовка к деплою
4. Документация

---

## Файлы конфигурации

### Backend package.json
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "@prisma/client": "^5.7.1",
    "prisma": "^5.7.1",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3",
    "dotenv": "^16.3.1",
    "zod": "^3.22.4"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.5",
    "typescript": "^5.3.3",
    "ts-node": "^10.9.2",
    "nodemon": "^3.0.2"
  }
}
```

### Telegram Bot package.json
```json
{
  "dependencies": {
    "node-telegram-bot-api": "^0.64.0",
    "axios": "^1.6.2",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "@types/node": "^20.10.5",
    "@types/node-telegram-bot-api": "^0.64.5",
    "typescript": "^5.3.3",
    "ts-node": "^10.9.2"
  }
}
```

### Frontend package.json (основные зависимости)
```json
{
  "dependencies": {
    "next": "14.0.4",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "typescript": "5.3.3",
    "tailwindcss": "3.3.6",
    "axios": "1.6.2",
    "@telegram-apps/sdk": "latest"
  }
}
```

---

## Переменные окружения

### Backend (.env)
```
DATABASE_URL=sqlite:///./salon.db
SECRET_KEY=your-secret-key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
TELEGRAM_BOT_TOKEN=your-bot-token
```

### Telegram Bot (.env)
```
TELEGRAM_BOT_TOKEN=your-bot-token
BACKEND_API_URL=http://localhost:3001
WEBAPP_URL=https://your-domain.com/client-app
```

---

## Дополнительные возможности (будущие итерации)

1. **Интеграция с платежными системами**
2. **SMS уведомления**
3. **Email уведомления**
4. **Система лояльности**
5. **Отзывы и рейтинги**
6. **Фото работ мастеров**
7. **Онлайн консультации**
8. **Интеграция с календарем Google**

---

Этот план обеспечивает поэтапную разработку полнофункциональной системы записи для салона красоты с минимальным начальным функционалом и возможностью расширения.
